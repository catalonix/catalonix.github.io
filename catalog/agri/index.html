<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHQ 노지 생육/위성 통합 관제</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* [테마] 다크 사이언스 테마 (Dark Science) */
        :root { --bg-dark: #0f172a; --card-bg: #1e293b; --accent-cyan: #06b6d4; --accent-green: #10b981; }
        body { background-color: var(--bg-dark); color: #cbd5e1; font-family: 'Pretendard', sans-serif; overflow: hidden; }
        
        /* 컴포넌트 스타일 */
        .card { background-color: var(--card-bg); border: 1px solid #334155; border-radius: 0.5rem; display: flex; flex-direction: column; }
        .tab-content { display: none; height: 100%; animation: fadeIn 0.4s ease; }
        .tab-content.active { display: flex; flex-direction: column; gap: 1rem; }
        
        /* 스크롤바 */
        .custom-scroll::-webkit-scrollbar { width: 5px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }

        /* 타일형 히트맵 스타일 */
        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(20, 1fr); /* 20열 */
            gap: 2px;
            width: 100%;
            height: 100%;
        }
        .grid-tile {
            background-color: #334155;
            border-radius: 2px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        .grid-tile:hover {
            transform: scale(1.2);
            z-index: 10;
            border: 1px solid white;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        
        /* 분석 모드 버튼 스타일 */
        .mode-btn { transition: all 0.2s; }
        .mode-btn.active { background-color: #0e7490; color: white; border-color: #22d3ee; box-shadow: 0 0 10px rgba(6, 182, 212, 0.4); }

        /* 생육 상태 뱃지 */
        .growth-badge { padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: bold; }
        .growth-good { background: rgba(16, 185, 129, 0.2); color: #34d399; border: 1px solid #059669; }
        .growth-bad { background: rgba(239, 68, 68, 0.2); color: #f87171; border: 1px solid #b91c1c; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="flex h-screen w-full text-sm select-none">

    <!-- 1. 사이드바 -->
    <nav class="w-16 bg-slate-900 border-r border-slate-800 flex flex-col items-center py-5 shrink-0 z-50">
        <div class="mb-8 w-10 h-10 rounded-xl bg-cyan-700 flex items-center justify-center text-white font-bold text-lg shadow-lg shadow-cyan-900/50">
            <i class="fa-solid fa-satellite-dish"></i>
        </div>
        
        <div class="flex flex-col gap-6 w-full">
            <button onclick="switchTab('dashboard')" class="nav-btn active group flex flex-col items-center gap-1 text-gray-400 hover:text-cyan-400" id="nav-dashboard">
                <i class="fa-solid fa-chart-line text-xl"></i><span class="text-[9px]">대시보드</span>
            </button>
            <button onclick="switchTab('satellite')" class="nav-btn group flex flex-col items-center gap-1 text-gray-400 hover:text-cyan-400" id="nav-satellite">
                <i class="fa-solid fa-layer-group text-xl"></i><span class="text-[9px]">위성분석</span>
            </button>
            <button onclick="switchTab('fields')" class="nav-btn group flex flex-col items-center gap-1 text-gray-400 hover:text-cyan-400" id="nav-fields">
                <i class="fa-solid fa-map-location-dot text-xl"></i><span class="text-[9px]">현장현황</span>
            </button>
            <button onclick="switchTab('equipment')" class="nav-btn group flex flex-col items-center gap-1 text-gray-400 hover:text-cyan-400" id="nav-equipment">
                <i class="fa-solid fa-tractor text-xl"></i><span class="text-[9px]">장비관리</span>
            </button>
        </div>
    </nav>

    <!-- 2. 메인 컨텐츠 -->
    <main class="flex-grow p-4 bg-[#0f172a] overflow-hidden flex flex-col relative">
        
        <!-- 헤더 -->
        <header class="flex justify-between items-center mb-4 shrink-0 h-10">
            <div>
                <h2 class="text-xl font-bold text-white flex items-center gap-2" id="page-title">
                    <span class="w-1.5 h-5 bg-cyan-500 rounded-sm shadow-[0_0_10px_#06b6d4]"></span> 종합 생육 대시보드
                </h2>
                <p class="text-[11px] text-gray-400 ml-4 flex items-center gap-1">
                    <i class="fa-solid fa-location-crosshairs text-cyan-500"></i> 전라북도 김제시 스마트팜 혁신밸리 (노지 구역)
                </p>
            </div>
            
            <div class="flex items-center gap-3">
                 <div class="bg-slate-800 px-3 py-1 rounded border border-slate-700 flex gap-3 text-xs">
                    <div class="flex items-center gap-1"><i class="fa-solid fa-satellite text-blue-400"></i> <span class="text-gray-300">Sentinel-2 (Updated)</span></div>
                    <div class="w-px bg-slate-600"></div>
                    <div class="flex items-center gap-1"><i class="fa-solid fa-cloud-sun text-yellow-500"></i> <span class="text-white font-bold">21°C</span></div>
                </div>
            </div>
        </header>

        <!-- [TAB 1] Dashboard (요약) -->
        <div id="tab-dashboard" class="tab-content active">
            <!-- Top KPIs -->
            <div class="grid grid-cols-4 gap-4 h-32 shrink-0">
                <div class="card p-4 justify-between bg-gradient-to-br from-cyan-900/40 to-slate-800">
                    <div class="text-gray-400 text-xs">평균 식생지수 (NDVI)</div>
                    <div class="text-3xl font-bold text-white">0.84 <span class="text-xs font-normal text-green-400">▲ 0.02</span></div>
                    <div class="text-[10px] text-gray-400">전년 동기 대비 생육 양호</div>
                    <div class="w-full bg-slate-700 h-1 rounded mt-1"><div class="bg-cyan-500 w-[84%] h-full rounded shadow-[0_0_5px_#06b6d4]"></div></div>
                </div>
                <div class="card p-4 justify-between">
                    <div class="text-gray-400 text-xs">작물 수분 스트레스 (NDMI)</div>
                    <div class="text-3xl font-bold text-blue-400">Low</div>
                    <div class="text-[10px] text-gray-400">관수 상태 적정 유지 중</div>
                </div>
                <div class="card p-4 justify-between">
                    <div class="text-gray-400 text-xs">병해충/스트레스 경고</div>
                    <div class="text-3xl font-bold text-yellow-500">2 <span class="text-sm text-gray-500">건</span></div>
                    <div class="text-xs text-gray-400">B-2 구역 황화 현상 감지</div>
                </div>
                <div class="card p-4 justify-between border-cyan-500/30 bg-cyan-950/10">
                    <div class="text-cyan-400 text-xs font-bold"><i class="fa-solid fa-robot mr-1"></i> AI Agronomist Insight</div>
                    <p class="text-[11px] text-gray-300 leading-relaxed">
                        "현재 A구역의 엽록소 지수 상승세가 둔화되었습니다. <span class="text-white font-bold">질소 추비</span>를 10% 증량하고, B구역은 배수를 점검하세요."
                    </p>
                </div>
            </div>

            <!-- Charts -->
            <div class="grid grid-cols-3 gap-4 flex-grow min-h-0">
                <div class="col-span-2 card p-4">
                    <h3 class="text-gray-300 font-bold text-sm mb-2">작물 생육 곡선 (NDVI Time Series)</h3>
                    <div class="relative w-full flex-grow"><canvas id="growthChart"></canvas></div>
                </div>
                <div class="card p-4">
                    <h3 class="text-gray-300 font-bold text-sm mb-2">필지별 환경 점수</h3>
                    <div class="space-y-3 mt-2">
                        <div>
                            <div class="flex justify-between text-xs mb-1 text-gray-400"><span>A-1 (마늘)</span><span class="text-green-400">92점</span></div>
                            <div class="w-full bg-slate-700 h-1.5 rounded"><div class="bg-green-500 w-[92%] h-full rounded"></div></div>
                        </div>
                        <div>
                            <div class="flex justify-between text-xs mb-1 text-gray-400"><span>B-2 (양파)</span><span class="text-yellow-400">75점 (수분 과다)</span></div>
                            <div class="w-full bg-slate-700 h-1.5 rounded"><div class="bg-yellow-500 w-[75%] h-full rounded"></div></div>
                        </div>
                        <div>
                            <div class="flex justify-between text-xs mb-1 text-gray-400"><span>C-1 (콩)</span><span class="text-blue-400">88점</span></div>
                            <div class="w-full bg-slate-700 h-1.5 rounded"><div class="bg-blue-500 w-[88%] h-full rounded"></div></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- [TAB 2] Satellite Analysis (타일형 히트맵) -->
        <div id="tab-satellite" class="tab-content">
            <div class="grid grid-cols-12 gap-4 h-full">
                
                <!-- 좌측: 타일 분석 그리드 (8칸) -->
                <div class="col-span-8 card relative p-4 border-cyan-500/30 flex flex-col">
                    <!-- 헤더 및 컨트롤 -->
                    <div class="flex justify-between items-center mb-3 shrink-0">
                        <h3 class="text-white font-bold flex items-center gap-2 text-sm">
                            <i class="fa-solid fa-th text-cyan-500"></i> 필지별 정밀 분석 히트맵 (Grid Analysis)
                        </h3>
                        <div class="flex bg-slate-800 p-1 rounded border border-slate-700 gap-1">
                            <button onclick="renderSatelliteGrid('NDVI', this)" class="mode-btn active text-xs px-3 py-1 rounded text-gray-300 hover:text-white">NDVI (식생)</button>
                            <button onclick="renderSatelliteGrid('MOISTURE', this)" class="mode-btn text-xs px-3 py-1 rounded text-gray-300 hover:text-white">수분 (Moisture)</button>
                            <button onclick="renderSatelliteGrid('PEST', this)" class="mode-btn text-xs px-3 py-1 rounded text-gray-300 hover:text-white">병해충 (Stress)</button>
                        </div>
                    </div>

                    <!-- 그리드 컨테이너 -->
                    <div class="relative flex-grow bg-slate-900 rounded border border-slate-700 overflow-hidden p-1">
                        <div id="analysis-grid" class="analysis-grid w-full h-full">
                            <!-- JS로 타일 생성 -->
                        </div>
                        
                        <!-- 범례 (Overlay) -->
                        <div class="absolute bottom-4 right-4 bg-slate-900/90 p-2 rounded border border-slate-700 text-[10px] text-gray-300 shadow-lg pointer-events-none">
                            <div class="mb-1 font-bold text-center" id="legend-title">Index Level</div>
                            <div class="flex items-center gap-2">
                                <span>Low</span>
                                <div class="w-24 h-2 rounded bg-gradient-to-r" id="legend-gradient"></div>
                                <span>High</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 우측: 상세 분석 패널 (4칸) -->
                <div class="col-span-4 flex flex-col gap-3 h-full">
                    <div class="card p-4 shrink-0 border-l-4 border-l-cyan-500">
                        <h3 class="text-cyan-400 font-bold text-sm mb-1" id="tile-info-title">전체 구역 요약</h3>
                        <div class="flex gap-2 text-[10px] text-gray-400" id="tile-info-sub">
                            <span>총 면적: 3,500m²</span> | <span>분석 타일: 400개</span>
                        </div>
                    </div>

                    <div class="card p-4 flex-grow overflow-y-auto custom-scroll">
                        <h4 class="text-xs font-bold text-gray-300 mb-3">스펙트럼 반사율 분석</h4>
                        <div class="h-40 relative w-full mb-4">
                            <canvas id="spectralChart"></canvas>
                        </div>
                        
                        <div class="space-y-3">
                            <div class="bg-slate-800 p-3 rounded border border-slate-700">
                                <div class="flex justify-between items-center mb-1">
                                    <span class="text-xs text-gray-400">타일 평균 값</span>
                                    <span class="text-xs font-bold text-white" id="stat-avg">0.76 (양호)</span>
                                </div>
                                <div class="w-full bg-slate-900 h-1.5 rounded"><div class="bg-cyan-500 w-[76%] h-full rounded transition-all duration-500" id="stat-bar-1"></div></div>
                            </div>
                            <div class="bg-slate-800 p-3 rounded border border-slate-700">
                                <div class="flex justify-between items-center mb-1">
                                    <span class="text-xs text-gray-400">이상 징후 비율</span>
                                    <span class="text-xs font-bold text-yellow-400" id="stat-warn">12% (주의)</span>
                                </div>
                                <div class="w-full bg-slate-900 h-1.5 rounded"><div class="bg-yellow-500 w-[12%] h-full rounded transition-all duration-500" id="stat-bar-2"></div></div>
                            </div>
                        </div>
                        
                        <div class="mt-4 p-3 bg-cyan-900/20 border border-cyan-500/30 rounded text-[11px] text-gray-300">
                            <i class="fa-solid fa-circle-info text-cyan-400 mr-1"></i>
                            지도상의 타일을 클릭하면 해당 세부 구역의 스펙트럼 데이터와 상세 분석 정보를 확인할 수 있습니다.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- [TAB 3] Field Monitor (현장 현황 - 그리드) -->
        <div id="tab-fields" class="tab-content">
            <div class="flex justify-between items-center mb-2">
                <div class="text-xs text-gray-400">실시간 센서 데이터 (Updated: 10s ago)</div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 overflow-y-auto custom-scroll pr-1 pb-2 h-full">
                <!-- Card 1 -->
                <div class="card p-0 overflow-hidden hover:border-cyan-500 transition-colors">
                    <div class="relative h-28">
                        <img src="https://images.unsplash.com/photo-1592982537447-6f2a6a0c8019?q=80&w=800&auto=format&fit=crop" class="w-full h-full object-cover opacity-70" alt="Field">
                        <div class="absolute top-2 right-2 growth-badge growth-good backdrop-blur-md">생육 왕성</div>
                        <div class="absolute bottom-2 left-2 text-white font-bold text-sm shadow-black drop-shadow-md">A-1 구역 (마늘)</div>
                    </div>
                    <div class="p-3 grid grid-cols-3 gap-2 text-center">
                        <div class="bg-slate-800 p-2 rounded">
                            <div class="text-[10px] text-gray-500">토양수분</div>
                            <div class="text-sm font-bold text-blue-400">32%</div>
                        </div>
                        <div class="bg-slate-800 p-2 rounded">
                            <div class="text-[10px] text-gray-500">EC</div>
                            <div class="text-sm font-bold text-green-400">1.2</div>
                        </div>
                        <div class="bg-slate-800 p-2 rounded">
                            <div class="text-[10px] text-gray-500">지온</div>
                            <div class="text-sm font-bold text-orange-400">18°C</div>
                        </div>
                    </div>
                </div>
                <!-- Card 2 -->
                <div class="card p-0 overflow-hidden border-yellow-600/50">
                    <div class="relative h-28">
                        <img src="https://images.unsplash.com/photo-1500382017468-9049fed747ef?q=80&w=800&auto=format&fit=crop" class="w-full h-full object-cover opacity-70" alt="Field">
                        <div class="absolute top-2 right-2 growth-badge growth-bad backdrop-blur-md">수분 부족</div>
                        <div class="absolute bottom-2 left-2 text-white font-bold text-sm shadow-black drop-shadow-md">B-2 구역 (양파)</div>
                    </div>
                    <div class="p-3 grid grid-cols-3 gap-2 text-center">
                        <div class="bg-slate-800 p-2 rounded border border-yellow-900">
                            <div class="text-[10px] text-yellow-500">토양수분</div>
                            <div class="text-sm font-bold text-yellow-400 animate-pulse">15%</div>
                        </div>
                        <div class="bg-slate-800 p-2 rounded">
                            <div class="text-[10px] text-gray-500">EC</div>
                            <div class="text-sm font-bold text-green-400">1.5</div>
                        </div>
                        <div class="bg-slate-800 p-2 rounded">
                            <div class="text-[10px] text-gray-500">지온</div>
                            <div class="text-sm font-bold text-orange-400">22°C</div>
                        </div>
                    </div>
                </div>
                <!-- Card 3 -->
                <div class="card p-0 overflow-hidden hover:border-cyan-500 transition-colors">
                    <div class="relative h-28">
                        <img src="https://images.unsplash.com/photo-1625246333195-58f214f77812?q=80&w=800&auto=format&fit=crop" class="w-full h-full object-cover opacity-70" alt="Field">
                        <div class="absolute top-2 right-2 growth-badge growth-good backdrop-blur-md">생육 정상</div>
                        <div class="absolute bottom-2 left-2 text-white font-bold text-sm shadow-black drop-shadow-md">C-1 구역 (콩)</div>
                    </div>
                    <div class="p-3 grid grid-cols-3 gap-2 text-center">
                        <div class="bg-slate-800 p-2 rounded">
                            <div class="text-[10px] text-gray-500">토양수분</div>
                            <div class="text-sm font-bold text-blue-400">35%</div>
                        </div>
                        <div class="bg-slate-800 p-2 rounded">
                            <div class="text-[10px] text-gray-500">EC</div>
                            <div class="text-sm font-bold text-green-400">0.9</div>
                        </div>
                        <div class="bg-slate-800 p-2 rounded">
                            <div class="text-[10px] text-gray-500">지온</div>
                            <div class="text-sm font-bold text-orange-400">20°C</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- [TAB 4] Equipment (장비 관리) -->
        <div id="tab-equipment" class="tab-content">
             <div class="flex gap-4 h-full">
                <div class="w-2/3 grid grid-cols-2 gap-3 overflow-y-auto custom-scroll pr-1">
                    <div class="card p-3 flex-row gap-3 items-center border-l-4 border-l-green-500">
                        <div class="w-12 h-12 bg-slate-800 rounded-full flex items-center justify-center text-xl text-green-400"><i class="fa-solid fa-tractor"></i></div>
                        <div class="flex-grow">
                            <div class="flex justify-between"><span class="text-white font-bold text-sm">트랙터 T-01</span><span class="text-[10px] bg-green-900 text-green-300 px-1 rounded">작업중</span></div>
                            <div class="text-[10px] text-gray-400">A-1 구역 경운 작업 중 | 연료 45%</div>
                            <div class="w-full bg-slate-800 h-1 mt-1 rounded"><div class="bg-green-500 w-[45%] h-full rounded"></div></div>
                        </div>
                    </div>
                    <div class="card p-3 flex-row gap-3 items-center border-l-4 border-l-red-500">
                        <div class="w-12 h-12 bg-slate-800 rounded-full flex items-center justify-center text-xl text-red-400"><i class="fa-solid fa-faucet-drip"></i></div>
                        <div class="flex-grow">
                            <div class="flex justify-between"><span class="text-white font-bold text-sm">양수기 P-03</span><span class="text-[10px] bg-red-900 text-red-300 px-1 rounded">점검요망</span></div>
                            <div class="text-[10px] text-gray-400">필터 막힘 알림 (Code: E-404)</div>
                        </div>
                    </div>
                    <div class="card p-3 flex-row gap-3 items-center border-l-4 border-l-gray-500">
                        <div class="w-12 h-12 bg-slate-800 rounded-full flex items-center justify-center text-xl text-gray-400"><i class="fa-solid fa-plane-up"></i></div>
                        <div class="flex-grow">
                            <div class="flex justify-between"><span class="text-white font-bold text-sm">방제 드론 D-01</span><span class="text-[10px] bg-gray-700 text-gray-300 px-1 rounded">대기중</span></div>
                            <div class="text-[10px] text-gray-400">충전 완료 (100%) | 차고지 대기</div>
                        </div>
                    </div>
                </div>
                <div class="w-1/3 card p-4">
                    <h3 class="text-sm font-bold text-gray-300 mb-2">장비 가동 현황</h3>
                    <div class="relative w-full flex-grow"><canvas id="equipChart"></canvas></div>
                </div>
            </div>
        </div>

    </main>

    <script>
        /**
         * 1. 탭 시스템
         */
        const pageTitles = {
            'dashboard': '종합 생육 대시보드',
            'satellite': '위성/분광 분석 시스템',
            'fields': '노지 필지 모니터링',
            'equipment': '영농 장비 관리'
        };

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(el => {
                el.classList.remove('active', 'text-cyan-400');
                el.classList.add('text-gray-400');
            });

            document.getElementById(`tab-${tabId}`).classList.add('active');
            const navBtn = document.getElementById(`nav-${tabId}`);
            navBtn.classList.add('active', 'text-cyan-400');
            navBtn.classList.remove('text-gray-400');

            document.getElementById('page-title').innerHTML = `
                <span class="w-1.5 h-5 bg-cyan-500 rounded-sm shadow-[0_0_10px_#06b6d4]"></span> ${pageTitles[tabId]}
            `;
            
            // 탭 변경 시 차트 리사이즈 및 그리드 초기화
            if(tabId === 'satellite') {
                if(document.getElementById('analysis-grid').children.length === 0) {
                    renderSatelliteGrid('NDVI');
                }
            }
            window.dispatchEvent(new Event('resize'));
        }

        /**
         * 2. 위성 타일 히트맵 렌더링
         */
        function renderSatelliteGrid(mode, btn) {
            // 버튼 상태 업데이트
            if(btn) {
                document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            }

            const gridContainer = document.getElementById('analysis-grid');
            gridContainer.innerHTML = ''; // 초기화

            const legendGradient = document.getElementById('legend-gradient');
            
            // 모드별 색상 설정
            let getColor;
            if (mode === 'NDVI') {
                document.getElementById('legend-title').innerText = 'NDVI (식생 활력도)';
                legendGradient.className = 'w-24 h-2 rounded bg-gradient-to-r from-red-500 via-yellow-500 to-green-500';
                getColor = (val) => {
                    if (val < 0.3) return `rgba(239, 68, 68, ${0.3 + val})`; // Red
                    if (val < 0.6) return `rgba(234, 179, 8, ${0.3 + val})`; // Yellow
                    return `rgba(34, 197, 94, ${0.2 + val})`; // Green
                };
            } else if (mode === 'MOISTURE') {
                document.getElementById('legend-title').innerText = 'Moisture (수분)';
                legendGradient.className = 'w-24 h-2 rounded bg-gradient-to-r from-gray-500 via-blue-400 to-blue-600';
                getColor = (val) => {
                    if (val < 0.3) return `rgba(100, 116, 139, ${0.3 + val})`; // Dry
                    return `rgba(59, 130, 246, ${0.2 + val})`; // Wet
                };
            } else { // PEST
                document.getElementById('legend-title').innerText = 'Stress (병해충)';
                legendGradient.className = 'w-24 h-2 rounded bg-gradient-to-r from-green-500 via-yellow-500 to-purple-500';
                getColor = (val) => {
                    if (val < 0.2) return `rgba(34, 197, 94, 0.3)`; // Healthy
                    if (val < 0.6) return `rgba(234, 179, 8, ${0.2 + val})`; // Warning
                    return `rgba(168, 85, 247, ${0.4 + val})`; // Pest/Disease
                };
            }

            // 20x15 그리드 (300개 타일) 생성
            const cols = 20;
            const rows = 14; 
            
            for(let i=0; i<cols*rows; i++) {
                const tile = document.createElement('div');
                tile.className = 'grid-tile';
                
                // Perlin Noise 비슷한 효과를 위한 랜덤 값 생성
                // 인접 타일과 비슷하게 하여 자연스러운 분포 시뮬레이션
                const x = i % cols;
                const y = Math.floor(i / cols);
                
                // 가상의 노이즈 생성 (단순화)
                let noise = Math.sin(x/5) * Math.cos(y/5) + Math.random() * 0.3;
                let val = (noise + 1) / 2; // 0~1 사이 정규화

                // 특정 구역(병해충 모드 등) 강조
                if(mode === 'PEST' && x > 12 && y > 8) val += 0.4; // 우측 하단 병해충 발생 시뮬레이션

                tile.style.backgroundColor = getColor(val);
                tile.title = `Tile (${x},${y}): ${val.toFixed(2)}`;
                
                // 클릭 이벤트
                tile.onclick = () => showTileDetail(x, y, val, mode);
                
                gridContainer.appendChild(tile);
            }
        }

        // 초기 렌더링
        renderSatelliteGrid('NDVI');

        function showTileDetail(x, y, val, mode) {
            document.getElementById('tile-info-title').innerText = `Tile Sector (${x}, ${y})`;
            document.getElementById('tile-info-sub').innerText = `Value: ${val.toFixed(3)} | Mode: ${mode}`;
            
            // 통계바 업데이트 시뮬레이션
            const percent = Math.floor(val * 100);
            document.getElementById('stat-avg').innerText = `${val.toFixed(2)} (${val > 0.6 ? '양호' : '주의'})`;
            document.getElementById('stat-bar-1').style.width = `${percent}%`;
            
            // 스펙트럼 차트 업데이트 (랜덤 변형)
            updateSpectralChart([
                5 + Math.random()*5, 
                10 + Math.random()*5, 
                8 + Math.random()*5, 
                20 + val * 40, 
                40 + val * 50
            ]);
        }


        /**
         * 3. 차트 초기화 (Chart.js)
         */
        Chart.defaults.color = '#9ca3af';
        Chart.defaults.borderColor = '#334155';
        Chart.defaults.font.family = "'Pretendard', sans-serif";

        // (1) 대시보드 생육 곡선
        new Chart(document.getElementById('growthChart'), {
            type: 'line',
            data: {
                labels: ['9월', '10월', '11월', '12월', '1월', '2월'],
                datasets: [
                    { label: '목표 생육', data: [0.2, 0.4, 0.6, 0.7, 0.75, 0.8], borderColor: '#475569', borderDash: [5, 5], pointRadius: 0, tension: 0.4 },
                    { label: '실제 생육', data: [0.22, 0.45, 0.62, 0.71, 0.80, 0.84], borderColor: '#06b6d4', backgroundColor: 'rgba(6, 182, 212, 0.1)', fill: true, tension: 0.4 }
                ]
            },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top', align: 'end' } }, scales: { y: { min: 0, max: 1 } } }
        });

        // (2) 스펙트럼 차트
        let spectralChart;
        function initSpectralChart() {
            const ctx = document.getElementById('spectralChart').getContext('2d');
            spectralChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['400nm', '500nm', '600nm', '700nm', '800nm'],
                    datasets: [{
                        label: 'Reflectance',
                        data: [5, 10, 8, 40, 85],
                        borderColor: '#10b981',
                        borderWidth: 2,
                        pointBackgroundColor: '#fff',
                        tension: 0.3
                    }]
                },
                options: { 
                    responsive: true, maintainAspectRatio: false, 
                    plugins: { legend: { display: false } },
                    scales: { y: { display: false }, x: { grid: { display: false } } }
                }
            });
        }
        function updateSpectralChart(newData) {
            spectralChart.data.datasets[0].data = newData;
            // NDRE가 낮으면(Red Edge 낮음) 경고색
            if(newData[4] < 60) spectralChart.data.datasets[0].borderColor = '#eab308';
            else spectralChart.data.datasets[0].borderColor = '#10b981';
            spectralChart.update();
        }
        initSpectralChart();

        // (3) 장비 차트
        new Chart(document.getElementById('equipChart'), {
            type: 'doughnut',
            data: {
                labels: ['가동', '대기', '정비'],
                datasets: [{
                    data: [65, 30, 5],
                    backgroundColor: ['#10b981', '#475569', '#ef4444'],
                    borderWidth: 0
                }]
            },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right', labels: { boxWidth: 10, font: {size: 10} } } } }
        });

    </script>
</body>
</html>